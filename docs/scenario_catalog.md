# 高速公路功能场景调研与参数定义

## 1. 调研范围与数据来源

- **数据集**：HighD（德国高速公路自然驾驶轨迹，25 Hz）。包含每辆车的位置信息、速度、加速度、车道、相对车辆 ID 等。
- **标准与文献**：ISO 34502、ISO 21448(SOTIF) 附录案例、EuroNCAP AEB 规程、UNECE 自动驾驶法规草案、学术论文（Treiber Intelligent Driver Model、HighD 公开基准）以及 GitHub 项目（`TrafficScenarios-RFAPsClustering`、`HighD-dataset-extractors`、`MetaScenario`）。
- **适用范围**：多车高速公路行驶，包含直道、弯道、限速 60–130 km/h 区间，无复杂天气与施工。

## 2. 功能场景全景列表

表 1 汇总了高速公路 ADS 设计验证时最常见的 12 类功能场景。选择原则：

1. 在自然驾驶数据中出现频率高，且对纵向或横向安全功能有影响。
2. 可利用 HighD 的 `precedingId`、车道关系等字段自动识别。
3. 与行业标准测试工况或学术研究一致。

| 场景编号 | 场景名称 | 典型触发条件 | 关键参数 (示例) |
| --- | --- | --- | --- |
| S1 | **自由巡航 (free_driving)** | 无前车 (`precedingId <= 0`) 或前向间距 > 120 m，速度 ≥ 72 km/h | 纵向速度、纵向加速度、持续时间 |
| S2 | **稳定跟车 (car_following)** | `precedingId` 恒定，时间头距 (THW) 0.8–3 s，速度差 ≤ 3 m/s | 平均 THW、平均距离头距 (DHW)、平均相对速度、持续时间 |
| S3 | **前车制动 (lead_vehicle_braking)** | 前车纵向减速度 ≤ −2.5 m/s²，THW < 3.5 s | 前车最小减速度、最小 TTC、最小 THW、事件时长 |
| S4 | **自车制动 (ego_braking)** | 自车纵向减速度 ≤ −3 m/s²，速度在事件内降低 ≥ 1 m/s | 最小自车减速度、速度损失、事件时长 |
| S5 | **左侧切入 (cut_in_from_left)** | `precedingId` 从无/他车切换为新 ID，并与左邻车 ID 匹配 | 切入后间距、切入后相对速度、切入后 TTC |
| S6 | **右侧切入 (cut_in_from_right)** | `precedingId` 切换，并与右邻车 ID 匹配 | 切入后间距、切入后相对速度、切入后 TTC |
| S7 | **左侧切出 (cut_out_to_left)** | 现有前车 ID 消失，同时在左侧邻车列表出现 | 切出前间距、切出前相对速度 |
| S8 | **右侧切出 (cut_out_to_right)** | 现有前车 ID 消失，同时在右侧邻车列表出现 | 切出前间距、切出前相对速度 |
| S9 | **自车左变道 (ego_lane_change_left)** | `laneId` 减少且维持，存在非零横向速度 | 变道持续时间、最大横向速度、平均纵向速度 |
| S10 | **自车右变道 (ego_lane_change_right)** | `laneId` 增加且维持，存在非零横向速度 | 变道持续时间、最大横向速度、平均纵向速度 |
| S11 | **拥堵跟驰 (slow_traffic)** | 前车存在，速度 ≤ 30 km/h，THW ≤ 2 s | 平均速度、平均 THW、持续时间 |
| S12 | **接近静止目标 (stationary_lead)** | 前车速度 ≤ 2 m/s，TTC ≤ 4 s | 最小 TTC、前车平均速度、持续时间 |

附加说明：
- HighD 车道编号遵循德国高速公路惯例：数值越小车道越靠左。自车左变道表现为 `laneId` 减少。
- 时间头距 (THW)、距离头距 (DHW)、时间到碰撞 (TTC) 均由 HighD 直接提供；当原值为 0 或 −1 时需视为缺测。
- 切入/切出场景会与变道同时出现，但功能测试通常分别统计。

## 3. 关键参数定义与计算

- **纵向速度 (speed)**：`xVelocity`。
- **纵向加速度 (acceleration)**：`xAcceleration`。
- **时间头距 THW**：自车与前车之间的时间间隔。
- **距离头距 DHW**：自车与前车之间的空间距离。
- **时间到碰撞 TTC**：若速度保持不变，发生碰撞的时间。
- **相对速度 (relative_speed)**：`xVelocity - preceding_xVelocity`。
- **事件持续时间 (duration_s)**：事件帧数 / 帧率。
- **横向速度 (yVelocity)**：用于描述变道动态。

上述指标配合 KDE (Kernel Density Estimation) 估计概率分布，用于统计 ADS 在自然驾驶数据中的典型行为范围。

## 4. 自动识别方法概述

1. **数据预处理**：按 `id`、`frame` 排序，补充前车 (`precedingId`) 的速度、加速度，统一缺测值。
2. **事件检测**：基于规则的判别器（见 `scenario_parameter_collection/detection.py`），为每辆车独立识别各类场景。
3. **参数抽取**：在事件窗口内计算平均值、最小值、速度损失等关键参数。
4. **统计分析**：对所有事件做频率统计，并对每个场景的关键参数执行 KDE 估计，得到概率密度函数。

## 5. 应用场景

- ADS 功能安全与 SOTIF 场景库构建
- 测试用例优先级排序（按事件频次）
- 控制器校准（基于经验分布的阈值设定）
- 风险分析（识别罕见但风险较高的长尾场景）

## 6. 局限与扩展建议

- HighD 数据缺少天气、道路坡度信息，无法覆盖某些复杂场景。
- 规则基方法对噪声敏感，可引入 HMM、聚类或基于 Transformer 的事件检测增强鲁棒性。
- 可与 NGSIM、rounD 数据集结合，扩展到匝道汇入、环岛等场景。
- 参数分布目前采用 KDE，可根据需要改为 GMM、核量化等方法，并引入不确定性评估。
