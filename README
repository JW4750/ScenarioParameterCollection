# Scenario Parameter Collection

本项目提供基于 HighD 数据集的高速公路功能场景自动识别与参数统计工具，包括：

- **文献调研文档**：`docs/scenario_catalog.md` 汇总高速公路典型场景及关键参数。
- **Python 库**：`scenario_parameter_collection`，支持从 HighD `*_tracks.csv` 数据自动识别场景，统计发生频率，并计算关键参数的概率分布（KDE）。
- **命令行工具**：`python -m scenario_parameter_collection.cli`，批量处理 CSV 文件并输出统计结果。

## 功能特性

- 支持识别 12 类高速公路场景：自由巡航、稳定跟车、前车/自车制动、切入/切出、变道、拥堵跟驰、接近静止目标等。
- 自动补充前车的速度与加速度信息，基于规则的事件检测算法。
- 统计每类场景的发生频率以及关键参数的概率密度函数（Gaussian KDE）。
- 将事件明细、频率统计、分布估计导出为 CSV/JSON，便于后续分析与可视化。

## 安装

```bash
pip install -e .[dev]
```

依赖：Python ≥ 3.9、NumPy、Pandas、SciPy、PyTest（开发/测试）。

## 使用示例

1. **准备数据**：从 [https://www.highd-dataset.com/](https://www.highd-dataset.com/) 下载一个或多个 `*_tracks.csv` 文件，放置在 `data/` 目录。
2. **命令行执行**：

```bash
python -m scenario_parameter_collection.cli --tracks data/ --output-dir outputs
```

默认帧率为 25 Hz，可使用 `--frame-rate` 指定其他值。运行结束后将生成：

- `outputs/scenario_events.csv`：每个识别事件的起止帧及关键参数。
- `outputs/scenario_counts.csv`：各类场景发生次数。
- `outputs/parameter_distributions.json`：每个场景关键参数的概率密度函数（KDE 采样网格与概率值）。

## Python API

```python
from scenario_parameter_collection.highd_loader import load_tracks
from scenario_parameter_collection.detection import HighDScenarioDetector
from scenario_parameter_collection.statistics import estimate_parameter_distributions

tracks = load_tracks("data/01_tracks.csv")
detector = HighDScenarioDetector(frame_rate=25.0)
events = detector.detect(tracks)
stats = estimate_parameter_distributions(events)

print(stats.counts)
```

更多场景定义及参数说明见 `docs/scenario_catalog.md`。

## 测试

```bash
pytest
```

## 许可证

MIT License，详见 `LICENSE`。
